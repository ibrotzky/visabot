<!DOCTYPE html>
<html lang="en">
    <head>
        <title>VisaBot CRS Calculator</title>

        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
        <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
        <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>

        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

        <link rel="stylesheet" type="text/css" href="../css.css" />

    </head>
    <body>
        <div class="title">
            <img class="svg" id="u309" src="../../images/pasted-svg-400x213.svg?crc=4161460473" width="400" height="213" alt="" data-mu-svgfallback="../../images/pasted%20svg%20400x213_poster_.png?crc=4019588615">
        </div>
        <div id="chat" class="chat container-fluid">
            <div id="chatHistory" class="chatHistory"></div>
            <div class="row">
                <div id="question" class="question col-xs-10 col-sm-10 col-md-10 col-lg-10"></div>
            </div>
            <div class="row">
                <div id="options" class="options col-xs-offset-1 col-sm-offset-1 col-md-offset-1 col-lg-offset-1 col-xs-11 col-sm-11 col-md-11 col-lg-11"></div>
            </div>
        </div>

        <script>
            var chat = $("#chat");
            var chatHistory = $("#chatHistory");
            var question = $("#question");
            var options = $("#options");

            var payload = {};

            //payload = {"question":44,"name":"Bruno","married":true,"spouseCanadianCitizen":false,"spouseCommingAlong":true,"age":27,"educationLevel":4,"canadianDegreeDiplomaCertificate":false,"firstLanguageTest":2,"firstLanguageSpeaking":9,"firstLanguageListening":9,"firstLanguageReading":9,"firstLanguageWriting":9,"secondLanguageTest":"0","workExperienceInCanada":"0","workExperienceLastTenYears":3,"certificateQualificationProvince":false,"validJobOffer":false, "nocJobOffer": undefined,"nominationCertificate":true,"spouseAge":42,"spouseEducationLevel":4,"spouseCanadianDegreeDiplomaCertificate":false,"spouseFirstLanguageTest":2,"spouseFirstLanguageSpeaking":9,"spouseFirstLanguageListening":9,"spouseFirstLanguageReading":9,"spouseFirstLanguageWriting":9,"spouseSecondLanguageTest":"0","spouseWorkExperienceInCanada":"0","spouseWorkExperienceLastTenYears":3,"spouseCertificateQualificationProvince":false,"spouseValidJobOffer":false,"spouseNominationCertificate":false};

            if (window.location.href.indexOf('?') > 0) {
                payload = {
                    "question": 44, "name": "Bruno", "married": true, "spouseCanadianCitizen": false, "spouseCommingAlong": true, "age": 33, "educationLevel": 4, "canadianDegreeDiplomaCertificate": false, "firstLanguageTest": 2, "firstLanguageSpeaking": 9, "firstLanguageListening": 9, "firstLanguageReading": 9, "firstLanguageWriting": 9, "secondLanguageTest": "0", "workExperienceInCanada": "0", "workExperienceLastTenYears": 3, "certificateQualificationProvince": false, "validJobOffer": false, "nocJobOffer": undefined, "nominationCertificate": false,
                    "spouseAge": 42, "spouseEducationLevel": 4, "spouseCanadianDegreeDiplomaCertificate": false, "spouseFirstLanguageTest": 2, "spouseFirstLanguageSpeaking": 9, "spouseFirstLanguageListening": 9, "spouseFirstLanguageReading": 9, "spouseFirstLanguageWriting": 9, "spouseSecondLanguageTest": "0", "spouseWorkExperienceInCanada": "0", "spouseWorkExperienceLastTenYears": 3, "spouseCertificateQualificationProvince": false, "spouseValidJobOffer": false, "spouseNominationCertificate": false
                };

                //payload = {"question":43,"name":"Douglas Miguel","married":true,"spouseCanadianCitizen":false,"spouseCommingAlong":true,"age":30,"educationLevel":4,"canadianDegreeDiplomaCertificate":false,"firstLanguageTest":"0","firstLanguageSpeaking":9,"firstLanguageListening":10,"firstLanguageReading":11,"firstLanguageWriting":8,"workExperienceInCanada":"0","workExperienceLastTenYears":3,"certificateQualificationProvince":false,"validJobOffer":false,"nominationCertificate":false,"spouseAge":30,"spouseEducationLevel":1,"spouseCanadianDegreeDiplomaCertificate":false,"spouseFirstLanguageTest":2,"spouseFirstLanguageSpeaking":10,"spouseFirstLanguageListening":10,"spouseFirstLanguageReading":10,"spouseFirstLanguageWriting":10,"spouseSecondLanguageTest":1,"spouseSecondLanguageSpeaking":10,"spouseSecondLanguageListening":10,"spouseSecondLanguageReading":10,"spouseSecondLanguageWriting":10,"spouseWorkExperienceInCanada":"0","spouseWorkExperienceLastTenYears":3,"spouseCertificateQualificationProvince":false,"spouseValidJobOffer":false};

                //payload = { "question": 44, "name": "Richard", "married": true, "spouseCanadianCitizen": false, "spouseCommingAlong": true, "age": 24, "educationLevel": 3, "canadianDegreeDiplomaCertificate": false, "firstLanguageTest": 2, "firstLanguageSpeaking": 9, "firstLanguageListening": 10, "firstLanguageReading": 10, "firstLanguageWriting": 10, "secondLanguageTest": "0", "workExperienceInCanada": "0", "workExperienceLastTenYears": 3, "certificateQualificationProvince": false, "validJobOffer": false, "nominationCertificate": false, "spouseAge": 24, "spouseEducationLevel": 1, "spouseCanadianDegreeDiplomaCertificate": false, "spouseFirstLanguageTest": "0", "spouseWorkExperienceInCanada": "0", "spouseWorkExperienceLastTenYears": "0", "spouseCertificateQualificationProvince": false, "spouseValidJobOffer": false, "spouseNominationCertificate": false };

                //payload = { "question": 44, "name": "Ilya", "married": true, "spouseCanadianCitizen": true, "age": 20, "educationLevel": 3, "canadianDegreeDiplomaCertificate": true, "canadianEducationLevel": 2, "firstLanguageTest": 3, "firstLanguageSpeaking": 10, "firstLanguageListening": 10, "firstLanguageReading": 10, "firstLanguageWriting": 10, "secondLanguageTest": 2, "secondLanguageSpeaking": 10, "secondLanguageListening": 10, "secondLanguageReading": 10, "secondLanguageWriting": 10, "workExperienceInCanada": 5, "workExperienceLastTenYears": 3, "certificateQualificationProvince": true, "validJobOffer": true, "nocJobOffer": "0", "nominationCertificate": true };

                //chat.remove("#chatHistory");
                //chat.remove("#question");
            }

            function answerQuestion(answer)
            {
                chat.find("input").attr('disabled', 'disabled');
                chat.find("button").attr('disabled', 'disabled');

                var request = {
                    "payload": payload,
                    "reply": answer
                }

                console.log('Request:', request);

                $.ajax({
                    type: 'GET',
                    url: '/api/canada/expressEntry',
                    cache: false,
                    dataType: 'json',
                    data: request
                }).success(function (data, textStatus, jqXHR)
                {
                    if (window.location.href.indexOf('?') < 0) {
                        if (payload.question >= 0) {
                            $("<div class='row'><div class='question  col-xs-10 col-sm-10 col-md-10 col-lg-10'>" + question.html() + "</div></div>").appendTo(chatHistory);
                        }

                        if (answer !== null) {
                            $("<div class='row'><div class='answer col-xs-offset-1 col-sm-offset-1 col-md-offset-1 col-lg-offset-1 col-xs-11 col-sm-11 col-md-11 col-lg-11'>" + answer + "</div></div>").appendTo(chatHistory);
                        }
                    }
                    var responseJSON = data.responseJSON;

                    payload = responseJSON.customPayload;

                    if (responseJSON.response === '')
                    { 
                        question.hide();
                        options.hide();
                    }
                    else {
                        question.html(responseJSON.response);
                        options.html('<br />');

                        if (responseJSON.quickReplies === null) {
                            var row = $("<div class='row'></div>");
                            var textbox = $("<div class='col-xs-10 col-sm-10 col-md-10 col-lg-10'><input id='replyInput' type='text' class='form-control'></input></div>");
                            var button = $("<div class='col-xs-2 col-sm-2 col-md-2 col-lg-2'><button id='reply' class='btn btn-block'>Reply</button></div>");

                            textbox.appendTo(row);
                            button.appendTo(row);

                            row.appendTo(options);

                            $("#reply").click(function ()
                            {
                                var name = $("#replyInput").val().trim();

                                if (name.length > 0)
                                    answerQuestion(name);
                            });
                        }
                        else {
                            for (r = 0; r < responseJSON.quickReplies.length; r++) {
                                var button = $("<button id='reply" + r + "'class='btn btn-default'>" + responseJSON.quickReplies[r] + "</button>");

                                button.appendTo(options);
                                $("<span>&nbsp</span>").appendTo(options);

                                $("#reply" + r).click(function ()
                                {
                                    answerQuestion($(this).text());
                                });
                            }
                        }

                        if (responseJSON.score === undefined)
                            $("html, body").animate({ scrollTop: $(document).height() }, "slow");
                    }

                    console.log('question:', payload.question);
                    console.log('responseJSON:', responseJSON);
                    console.log('payload:', JSON.stringify(payload));
                }).error(function (jqXHR, textStatus, errorThrown)
                {
                    chat.find("input").removeAttr('disabled');
                    chat.find("button").removeAttr('disabled');

                    console.log('Error: ', jqXHR.responseText);
                });
            }

            $(window).load(function ()
            {
                answerQuestion(null);
            });
        </script>

<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
</body>

</html>